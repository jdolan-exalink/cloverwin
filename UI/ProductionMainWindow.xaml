<Window x:Class="CloverBridge.UI.ProductionMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="CloverBridge"
        Height="550"
        Width="350"
        WindowStartupLocation="CenterScreen"
        Background="#0f172a"
        ResizeMode="CanMinimize"
        Closing="Window_Closing"
        StateChanged="Window_StateChanged">

    <Window.Resources>
        <!-- Estilos Unificados Minimalistas -->
        <Style x:Key="BaseButton" TargetType="Button">
            <Setter Property="Height" Value="55"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MainButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#6366f1"/>
        </Style>

        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#10b981"/>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#ef4444"/>
        </Style>

        <Style x:Key="GhostButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#1e293b"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#334155"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Status -->
            <RowDefinition Height="*"/>    <!-- Buttons Grid -->
            <RowDefinition Height="Auto"/> <!-- Large Config Button -->
            <RowDefinition Height="Auto"/> <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- Header: Title (Left) & Version (Right) -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,25">
            <TextBlock Text="CloverBridge" FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Bottom"/>
            <TextBlock x:Name="VersionTextBlock" Text="v1.2.0" Foreground="#475569" FontSize="12" VerticalAlignment="Bottom" Margin="8,0,0,2"/>
        </StackPanel>

        <!-- Status Card -->
        <Border Grid.Row="1" Background="#1e293b" CornerRadius="12" Padding="20" Margin="0,0,0,25">
            <StackPanel HorizontalAlignment="Center">
                <Ellipse x:Name="ConnectionStatusDot" Width="12" Height="12" Fill="#ef4444" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                <TextBlock x:Name="ConnectionStatusText" Text="Desconectado" Foreground="White" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Main Tabs -->
        <TabControl Grid.Row="2" Background="Transparent" BorderThickness="0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Header" Value="{Binding Header}"/>
                    <Setter Property="Foreground" Value="#94a3b8"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="Border" Padding="15,8" BorderThickness="0,0,0,2">
                                    <ContentPresenter ContentSource="Header" />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Border" Property="BorderBrush" Value="#6366f1"/>
                                        <Setter Property="Foreground" Value="#e2e8f0"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>

            <!-- TAB CLOVER -->
            <TabItem Header="CLOVER">
                <Grid Margin="0,15,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button x:Name="ConnectButton" Grid.Row="0" Grid.Column="0" Content="CONECTAR" Style="{StaticResource SuccessButton}" Click="ConnectButton_Click"/>
                    <Button x:Name="DisconnectButton" Grid.Row="0" Grid.Column="1" Content="DESCONECTAR" Style="{StaticResource DangerButton}" IsEnabled="False" Click="DisconnectButton_Click"/>
                    
                    <Button x:Name="MainPairingButton" Grid.Row="1" Grid.Column="0" Content="SINCRONIZAR" Style="{StaticResource MainButton}" Click="PairingButton_Click"/>
                    <Button x:Name="MainUnpairButton" Grid.Row="1" Grid.Column="1" Content="DESVINCULAR" Style="{StaticResource GhostButton}" IsEnabled="False" Click="UnpairButton_Click"/>

                    <Button x:Name="TestCloverButton" Grid.Row="2" Grid.ColumnSpan="2" Content="ðŸ§ª PRUEBA DE PAGO CLOVER" Style="{StaticResource GhostButton}" Height="50" Margin="5" Click="SendSaleButton_Click"/>
                </Grid>
            </TabItem>

            <!-- TAB MERCADO PAGO -->
            <TabItem Header="MERCADO PAGO">
                <StackPanel Margin="0,15,0,0">
                    <Border Background="#1e293b" CornerRadius="10" Padding="15" Margin="5">
                        <StackPanel>
                            <TextBlock Text="Estado QR Mercado Pago" Foreground="#94a3b8" FontSize="11" Margin="0,0,0,5"/>
                            <TextBlock x:Name="MpStatusText" Text="Listo para operar" Foreground="#10b981" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                    
                    <Button x:Name="TestMpButton" Content="ðŸ§ª PRUEBA DE PAGO QR MP" Style="{StaticResource SuccessButton}" Height="60" Margin="5" Click="TestMpSaleButton_Click"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="ðŸ“‹ VER LOGS" Style="{StaticResource GhostButton}" Height="50" Margin="5" Click="OpenLogsFolder_Click"/>
                        <Button Grid.Column="1" Content="ðŸ”— TEST API" Style="{StaticResource GhostButton}" Height="50" Margin="5" Click="TestMpApi_Click"/>
                    </Grid>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- Multi-Action Row: Config & Logs -->
        <Grid Grid.Row="3" Margin="0,15,0,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Content="âš™ï¸ CONFIGURACIÃ“N" Style="{StaticResource GhostButton}" Height="60" Margin="5,0" Click="OpenConfigPopup_Click"/>
            <Button Grid.Column="1" Content="ðŸ“‹ LOGS" Style="{StaticResource GhostButton}" Height="60" Margin="5,0" Click="OpenLogsFolder_Click"/>
        </Grid>

        <!-- Footer -->
        <StackPanel Grid.Row="4" Margin="0,15,0,0">
            <TextBlock x:Name="FooterStatusText" Text="Sistema listo para operar" Foreground="#64748b" FontSize="11" HorizontalAlignment="Center" Margin="0,0,0,5"/>
            <TextBlock Text="PRO VERSION Â© 2026" Foreground="#334155" FontSize="10" FontWeight="Bold" HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Pairing Code Overlay -->
        <Grid x:Name="PairingPopup" Grid.RowSpan="5" Background="#EE0f172a" Visibility="Collapsed">
            <Border Background="#1e293b" CornerRadius="20" Width="280" Height="320" VerticalAlignment="Center" Padding="30">
                <StackPanel>
                    <TextBlock Text="CÃ“DIGO PAIRING" Foreground="#6366f1" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                    <Border Background="#0f172a" CornerRadius="12" Padding="20" Margin="0,0,0,15">
                        <TextBlock x:Name="PopupPairingCode" Text="------" FontSize="42" FontWeight="Bold" Foreground="#10b981" HorizontalAlignment="Center"/>
                    </Border>
                    <TextBlock x:Name="PopupPairingStatus" Text="Ingresa el cÃ³digo..." Foreground="#94a3b8" TextAlignment="Center" FontSize="12" Margin="0,0,0,20" TextWrapping="Wrap"/>
                    <Button Content="CERRAR" Style="{StaticResource GhostButton}" Height="45" Click="ClosePairingPopup_Click"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Hidden inputs for Code-Behind compatibility -->
        <StackPanel Visibility="Collapsed">
            <TextBox x:Name="HostTextBox"/><TextBox x:Name="PortTextBox"/><TextBox x:Name="MerchantIdTextBox"/><TextBox x:Name="DeviceIdTextBox"/>
            <TextBox x:Name="TokenTextBox"/><CheckBox x:Name="SecureCheckBox"/><TextBox x:Name="ExternalIdTextBox"/><TextBox x:Name="InvoiceNumberTextBox"/>
            <TextBox x:Name="TestAmountTextBox"/><TextBlock x:Name="TestAmountPreview"/><TextBox x:Name="SystemLogTextBox"/>
            <Border x:Name="TimeoutCounterBorder"/><TextBlock x:Name="TimeoutCounterText"/>
        </StackPanel>
    </Grid>
</Window>
